/*! Stacked modal boxes v0.1.0 25.06.2014 */

!function(a,b){"use strict";function c(c){var d;if("string"==typeof c){if(a.fn.modalBox.globalSettings&&"string"==typeof a.fn.modalBox.globalSettings.NAMESPACE&&(d=a.fn.modalBox.globalSettings.NAMESPACE,b[d]&&a.isFunction(b[d][c])))return b[d][c];if(a.isFunction(b[c]))return b[c]}return a.isFunction(c)?c:function(){console.warn("Function not found",c)}}function d(b){b.preventDefault(),a(this).addClass("active").modalBox()}function e(a){27===a.keyCode&&(f(),a.preventDefault())}function f(){var a=m[m.length-1];a&&a.exitModal()}function g(a){var b,c,d,e=a.parents(".modal");if(e.length)for(b=e.data("modalBoxIndex"),d=m.length-1;d>=0;d--)d>=b&&(c=m[d],c&&c.exitModal(!0))}function h(c){var d,e,f,g,h,i,j,k=c.target,l=a(k),n=a(b),o=[],p=r,q=s;if(1!==c.which)return!1;for(a.fn.modalBox.globalSettings&&a.fn.modalBox.globalSettings.modalclass&&(p=a.fn.modalBox.globalSettings.modalclass),a.fn.modalBox.globalSettings&&a.fn.modalBox.globalSettings.wrapperclass&&(q=a.fn.modalBox.globalSettings.wrapperclass);k&&k!==document.body&&k!==document;){if(l=a(k),l.data("closeModal")===!0)return!1;if(l.hasClass(p)){for(e=l.data("modalBoxIndex"),h=m.length-1;h>=0;h--)h>e&&(d=m[h],d&&d.exitModal(!0));return!0}k=k.parentNode}if(l=a(c.target),i=n.outerWidth()-c.clientX<l[0].offsetWidth-l[0].clientWidth,j=n.outerHeight()-c.clientY<l[0].offsetHeight-l[0].clientHeight,i||j)return!1;if(1===m.length&&(d=m[0],d&&"none"===d.$wrapper[0].style.pointerEvents))return d.exitModal(!0),!0;if(f=l.data("modalBoxGroup")){for(h=m.length-1;h>=0;h--)d=m[h],d&&(g=d.$modalbox.data("modalBoxGroup"),g===f&&o.push(d));if(o.length)if(1===o.length&&o[0].options.closeonbackdrop===!0)o[0].exitModal(!0);else for(h=0;h<o.length-1;h++)o[h].options.closeonbackdrop===!0&&o[h].exitModal(!0)}else for(h=m.length-1;h>=0;h--)d=m[h],d&&d.exitModal(!0)}function i(){var a,b;for(b=0;k>b;b++)a=m[b],a&&a.updatePosition(a)}function j(){i()}var k=0,l=0,m=[],n=[],o=20,p=30,q=10,r="modal",s="modal-wrapper",t=!1,u={init:function(b,d){var e,f;this.options=a.extend({},a.fn.modalBox.settings,b,a.fn.modalBox.globalSettings),"fixed"===this.options.position&&(this.options.position="absolute"),this.loadable=!1,null!==this.options.nextto?this.$offspring=a(this.options.nextto):void 0!==d?this.$offspring=a(d):this.options.position="absolute","auto"===this.options.backdrop&&(this.options.backdrop="absolute"===this.options.position?!0:!1),this.createElements(),e=a(d).attr("href"),this.options.content===!1&&e&&(this.options.content=e),this.addContent(),this.loadable!==!0&&this.createCloseButton(),this.createArrow(),this.addEventListeners(),this.created=!0,c(this.options.beforeopen)(this.$offspring,this),a(document).trigger("beforeopen.modalBox",[this.$offspring,this]),this.loadable===!0?this.loadAjax(this.options.content):(this.afterOpen(!0),f=function(){this.$modalbox.removeClass("animated "+this.options.animopen)}.bind(this),t?this.$modalbox.addClass("animated "+this.options.animopen).on("animationend webkitAnimationEnd MSAnimationEnd",f):f())},afterOpen:function(b){b===!0&&this.updatePosition(),this.autoScroll(),c(this.options.afteropen)(this.$modalbox,this.$offspring,this),a(document).trigger("afteropen.modalBox",[this.$modalbox,this.$offspring,this])},createArrow:function(){return void 0===this.$offspring||"absolute"===this.options.position?void(this.$arrow=!1):(a('<div class="modal-arrow"></div>').appendTo(this.$modalbox),this.$arrow=this.$modalbox.find(".modal-arrow"),this.arrowWidth=this.$arrow.outerWidth(),void(this.arrowHeight=this.$arrow.outerHeight()))},createCloseButton:function(){this.options.closebutton===!0&&(this.$closeButton=a('<div class="modal-close" data-close-modal="true"><button type="button" class="close"><i class="'+this.options.closebuttonclass+'"></i></button></div>'),this.$modalbox.prepend(this.$closeButton))},createElements:function(){var b,c,d,e={display:"block"},f=s,g=r,i=this.options.mainwrapperclass,j="";a.fn.modalBox.globalSettings&&a.fn.modalBox.globalSettings.modalclass&&(g=a.fn.modalBox.globalSettings.modalclass),this.$offspring&&(b=this.$offspring.parents("."+g)),a.fn.modalBox.globalSettings&&a.fn.modalBox.globalSettings.mainwrapperclass&&(i=a.fn.modalBox.globalSettings.mainwrapperclass,a.fn.modalBox.globalSettings.mainwrapperextraclass&&(j+=" "+a.fn.modalBox.globalSettings.mainwrapperextraclass)),1===k?this.$wrapperWrapper=a("<div></div>").addClass(i+j).appendTo(a(document.body)):b&&(this.$wrapperWrapper=b.parents("."+i)),1===k||this.options.backdrop===!0?(this.$wrapper=a("<div></div>").addClass(f).css("z-index",9900+k).appendTo(this.$wrapperWrapper),1===k&&this.options.backdrop!==!0&&this.$wrapper.css({overflow:"hidden","pointer-events":"none"}),l++,this.$wrapper.data("modalBoxGroup",l),a(document).off("mousedown.modalBox").on("mousedown.modalBox",h)):b&&(this.$wrapper=b.parent()),this.hadNoScroll=a("html").hasClass(this.options.noscrollclass),this.options.backdrop===!0&&this.$wrapper.addClass("modal-backdrop"),"absolute"===this.options.position&&a("html").addClass(this.options.noscrollclass),"auto"===this.options.width&&(e.width="auto"),this.$modalbox=a("<div></div>").addClass(g).css(e).appendTo(this.$wrapper),this.options.closeonbackdrop===!0?this.$wrapper.addClass("modal-close-on-backdrop"):this.$wrapper.removeClass("modal-close-on-backdrop"),c=k-1,this.modalBoxIndex=c,this.$modalbox.data("modalBoxIndex",c),d=this.$wrapper.data("modalBoxGroup"),this.modalBoxGroup=d,this.$modalbox.data("modalBoxGroup",d)},addEventListeners:function(){this.$modalbox.on("click",'[data-close-modal="true"]',{modalbox:this.$modalbox},this.closeModalClick)},closeModalClick:function(b){var c,d,e=b.data.modalbox,f=e.data("modalBoxIndex"),g=a(this);for(b.preventDefault(),b.stopPropagation(),d=k-1;d>=0;d--)d>=f&&(c=m[d],c&&(g.data("modal")===!0?c.exitModal(!1,function(){g.modalBox()}):c.exitModal()))},loadAjax:function(b){var d,e,f,g;"string"==typeof b&&(b={url:b,dataType:"html",type:this.options.requestType}),this.$arrow&&(this.$arrow=this.$modalbox.find(".modal-arrow").detach()),this.$modalbox.html('<div style="padding: 40px; text-align: center;"><div class="'+this.options.spinnerclass+'"></div></div>'),this.$arrow&&this.$arrow.appendTo(this.$modalbox),this.updatePosition(),null!==this.options.params&&("string"==typeof this.options.params?b.data=a.parseJSON(this.options.params.replace(/'/g,'"')):"object"==typeof this.options.params&&(b.data=this.options.params)),this.$arrow&&this.arrowPosition(),this.ajaxRequest=a.ajax(b),d=function(a){this.$modalbox.hide(),this.$modalbox.html(a),this.$arrow&&this.$arrow.appendTo(this.$modalbox)}.bind(this),e=function(a,d){var e,f=this.options.msg_ajaxfailed;e=a&&a.responseText&&a.responseText.length>0?a.responseText:this.options.msg_ajaxfailed,b&&b.url&&(f+=" Url: "+b.url),"abort"!==d&&(console.warn(f),c(this.options.onerror)(this,a,d),this.$modalbox.trigger("onError.modalBox",[this,a,d])),this.$modalbox.html('<div style="padding: 10px;">'+e+"</div>")}.bind(this),f=function(){this.createCloseButton(),this.updatePosition(),this.updatePosition(),g=function(){this.$modalbox.removeClass("animated "+this.options.animopen),this.afterOpen()}.bind(this),t?this.$modalbox.show(0).addClass("animated "+this.options.animopen).on("animationend webkitAnimationEnd MSAnimationEnd",g):this.$modalbox.fadeIn(200,function(){g()})}.bind(this),this.ajaxRequest.fail(e),this.ajaxRequest.done(d),this.ajaxRequest.always(f)},addContent:function(){var b,c=this.options.content,d=c.match(/^https?:\/\//)||"/"===c.charAt(0);"#"===c.charAt(0)?(b=a(c),b.length>0?(b=b.children(),this.options.clone?b.clone(!0,!0).appendTo(this.$modalbox):(this.options.returncontent&&(this.returncontent=a(b[0]).parent()),0===b.length?this.$modalbox.html('<div style="padding: 10px;">No content in element: "'+c+'"</div>'):b.appendTo(this.$modalbox))):this.$modalbox.html('<div style="padding: 10px;">Could not find element: "'+c+'"</div>')):d?this.loadable=!0:this.$modalbox.html(c)},adjustToScroll:function(c){return c.left-=a(b).scrollLeft(),c.left+=this.$wrapper.scrollLeft(),c.top-=a(b).scrollTop(),c.top+=this.$wrapper.scrollTop(),c.left=Math.round(c.left),c.top=Math.round(c.top),c},positionBottom:function(a){var b={};return b.left=this.$offspring.offset().left+this.$offspring.outerWidth()/2-a.modalWidth/2,b.top=a.marginY+(this.$offspring.offset().top+this.$offspring.outerHeight()),this.arrowDirection="up",this.adjustToScroll(b)},positionTop:function(a){var b={};return b.left=this.$offspring.offset().left+this.$offspring.outerWidth()/2-a.modalWidth/2,b.top=-a.marginY+(this.$offspring.offset().top-a.modalHeight),this.arrowDirection="down",this.adjustToScroll(b)},positionLeft:function(a){var b={};return b.left=this.$offspring.offset().left-a.modalWidth-a.marginX,b.top=this.$offspring.offset().top+(this.$offspring.outerHeight()-a.modalHeight)/2,this.arrowDirection="right",this.adjustToScroll(b)},positionRight:function(a){var b={};return b.left=this.$offspring.offset().left+this.$offspring.outerWidth()+a.marginX,b.top=this.$offspring.offset().top+(this.$offspring.outerHeight()-a.modalHeight)/2,this.arrowDirection="left",this.adjustToScroll(b)},positionAbsolute:function(c){var d={},e=a(b);return d.left=e.width()/2-c.modalWidth/2+e.scrollLeft(),d.top=e.outerHeight()/2-c.modalHeight/2+e.scrollTop(),this.arrowDirection=!1,this.adjustToScroll(d)},updatePosition:function(){var c,d,e,f,g,h=a(b).width();return this&&this.options?("auto"!==this.options.width?(c=this.getModalWidth(),this.options.respectbrowserwidth&&c+p>h&&(c=h-p),this.$modalbox.width(c)):c=this.$modalbox.width(),d=this.$modalbox.height(),e={marginX:this.options.margin_x,marginY:this.options.margin_y,modalWidth:c,modalHeight:d},f="position"+this.options.position.charAt(0).toUpperCase()+this.options.position.substring(1),this.$offspring&&this.$offspring.selector&&(this.$offspring=a(this.$offspring.selector)),this[f]||(console.warn('ModalBox: Unknown position method "'+f+'"'),f="positionAbsolute"),g=this[f](e),this.$modalbox.css(g),a.extend(e,{left:parseInt(this.$modalbox.css("left"),10),top:parseInt(this.$modalbox.css("top"),10),windowWidth:h,windowHeight:a(b).height(),width:this.$modalbox.outerWidth(),height:this.$modalbox.outerHeight()}),this.adjustToWindow(e),void(this.$arrow&&this.arrowPosition())):!1},calcArrowLeft:function(){var c,d=parseInt(this.$modalbox.css("left"),10),e=this.$modalbox.outerWidth(),f=this.$offspring.offset().left,g=this.$offspring.outerWidth(),h=f+g/2,i=this.arrowWidth,j=i/2,k=6,l=e-i-6;return c=h-d-j,c-=a(b).scrollLeft(),c+=this.$wrapper.scrollLeft(),"bottom"===this.options.position&&this.$closeButton&&(l-=this.$closeButton.outerWidth()-Math.abs(parseInt(this.$closeButton.css("right"),10))),k>c?c=k:c>l&&(c=l),c},calcArrowTop:function(){var c,d=parseInt(this.$modalbox.css("top"),10),e=this.$modalbox.outerHeight(),f=this.$offspring.offset().top,g=this.$offspring.outerHeight(),h=f+g/2,i=this.arrowHeight,j=i/2,k=6,l=e-i-6;return c=h-d-j,c-=a(b).scrollTop(),c+=this.$wrapper.scrollTop(),k>c?c=k:c>l&&(c=l),c},arrowPosition:function(){var a,b;this.$arrow.removeClass("top bottom left right"),"up"===this.arrowDirection?(a=this.calcArrowLeft()+this.arrowWidth/2,b=-(this.arrowHeight/2),this.$arrow.css({left:Math.round(a),top:Math.round(b)}).addClass("bottom")):"down"===this.arrowDirection?(a=this.calcArrowLeft()+this.arrowWidth/2,b=this.$modalbox.height(),this.$arrow.css({left:Math.round(a),top:Math.round(b)}).addClass("top")):"right"===this.arrowDirection?(a=this.$modalbox.width(),b=this.calcArrowTop()+this.arrowHeight/2,this.$arrow.css({left:Math.round(a),top:Math.round(b)}).addClass("left")):"left"===this.arrowDirection&&(a=-(this.arrowWidth-this.arrowWidth/2),b=this.calcArrowTop()+this.arrowHeight/2,this.$arrow.css({left:Math.round(a),top:Math.round(b)}).addClass("right"))},adjustToWindow:function(c){var d,e;this.options.autoadjust===!0&&("left"===this.options.position||"right"===this.options.position?(c.top<q||c.left<o||c.left+c.width>c.windowWidth-10)&&(e=this.positionBottom(c),this.$modalbox.css(e)):"absolute"===this.options.position?c.top<q&&this.$modalbox.css("top",q):c.top<q?(e=this.positionBottom(c),this.$modalbox.css(e)):c.top+c.height+a(b).scrollTop()>a(document).height()&&(a("html").hasClass(this.options.noscrollclass)||(e=this.positionTop(c),this.$modalbox.css(e)))),c.left<o?this.$modalbox.css("left",o):c.left+c.modalWidth>c.windowWidth-p&&(d=Math.max(o,c.windowWidth-p-c.modalWidth),this.$modalbox.css("left",d))},getModalWidth:function(){var c=a(b).width(),d=this.options.width;return"string"==typeof d&&(d=c*parseInt(this.options.width,10)*.01),Math.max(this.options.minwidth,Math.min(c-20,Math.min(Number(this.options.maxwidth),d)))},autoScroll:function(){if(!this.options.autoscroll||"absolute"===this.options.position)return!1;var c,d,e=this.$modalbox.offset().top,f=this.$wrapper.scrollTop(),g=a(b).height(),h=a(b).scrollTop(),i=this.$modalbox.height(),j=20,k={duration:this.options.scrollspeed,easing:this.options.scrolleasing},l=m[0],n=!1;for(l&&"absolute"!==l.options.position&&(n=!0),d=1;d<m.length;d++)"absolute"===m[d].options.position&&(n=!1);n?h>e?a("body,html").animate({scrollTop:e-j},k):e-h+i>g&&(c=i>g?e-j:e+i-g+j,a("body,html").animate({scrollTop:c},k)):h>e+f?this.$wrapper.animate({scrollTop:e-j},k):e-h+i>g&&(c=i>g?e-h+f-j:e-h+f+i-g+j,this.$wrapper.animate({scrollTop:c},k))},exitModal:function(b,d){var e,f;c(this.options.beforeclose)(this.$modalbox,this.$offspring,this),this.$modalbox.trigger("beforeClose.modalBox",[this.$modalbox,this.$offspring,this]),this.ajaxRequest&&this.ajaxRequest.abort(),m.length&&(f=m[m.length-2],f&&(f.options.closeonbackdrop===!0?f.$wrapper.addClass("modal-close-on-backdrop"):f.$wrapper.removeClass("modal-close-on-backdrop"))),m.length&&(f=m[m.length-2],f&&(f.options.closeonbackdrop===!0?f.$wrapper.addClass("modal-close-on-backdrop"):f.$wrapper.removeClass("modal-close-on-backdrop"))),b!==!0&&this.options.animclose?(e=function(){this.$offspring&&this.$offspring.removeClass("active"),a.isFunction(d)?(this.cleanUp(),d.call(this)):this.cleanUp()}.bind(this),t?this.$modalbox.addClass("animated "+this.options.animclose).on("animationend webkitAnimationEnd MSAnimationEnd",e):this.$modalbox.fadeOut(200,function(){e()})):(this.cleanUp(),this.$offspring&&this.$offspring.removeClass("active"),a.isFunction(d)&&d.call(this))},cleanUp:function(){this.$arrow&&this.$arrow.remove(),this.$closeButton&&this.$closeButton.remove(),this.hadNoScroll===!1?a("html").removeClass(this.options.noscrollclass):a("html").addClass(this.options.noscrollclass),m.pop(),k=m.length,n.pop(),c(this.options.afterclose)(this.$modalbox,this.$offspring,this),this.$modalbox.trigger("afterClose.modalBox",[this.$modalbox,this.$offspring,this]),this.options.returncontent===!0&&void 0!==this.returncontent&&this.$modalbox.children().appendTo(this.returncontent),this.$modalbox.remove(),0===k&&this.$wrapperWrapper.remove(),0===this.$wrapper.children().length&&(this.$wrapper.remove(),l--)},toString:function(){return this.created===!0?"ModalBox [#"+this.modalBoxIndex+", g"+this.modalBoxGroup+"]":"ModalBox [uninitialized]"}};a.fn.modalBox=function(b){var c,d={};if("close"===b)return g(this),!0;if("updatePosition"===b)return i(),!0;for(c in b)b.hasOwnProperty(c)&&(d[c.toLowerCase()]=b[c]);return b=d,this.each(function(){for(var c=0;c<n.length;c++)if(this===n[c])return console.warn("ModalBox already initialized on element!"),console.dir(this),!1;n.push(this);var d,e,f,g,h=a(this).data(),i={};for(d in h)h.hasOwnProperty(d)&&0===d.indexOf("modal")&&(e=d.substr(5).toLowerCase(),e&&(i[e]=h[d]));b=a.extend(i,b),g=Object.keys(b);for(f in g)g.hasOwnProperty(f)&&(g[f]in a.fn.modalBox.settings||console.info('ModalBox option "'+g[f]+'" is invalid.'));m.push(Object.create(u)),k=m.length,m[k-1].init(b,this)})},a.fn.modalBox.settings={width:"auto",maxwidth:9999,minwidth:100,respectbrowserwidth:!0,scrollspeed:600,scrolleasing:"easeOutCirc",backdrop:"auto",closeonbackdrop:!0,position:"bottom",margin_x:15,margin_y:5,nextto:null,animopen:"fadeIn",animclose:"fadeOut",mainwrapperclass:"modals",noscrollclass:"noscroll",closebuttonclass:"fa fa-times",spinnerclass:"fa fa-cog fa-spin fa-5x",autoadjust:!0,autoscroll:!0,params:null,requestType:"GET",clone:!1,returncontent:!0,closebutton:!0,msg_ajaxfailed:"Request failed. Please try again.",beforeopen:a.noop,afteropen:a.noop,beforeclose:a.noop,afterclose:a.noop,onerror:a.noop,content:!1},a(document).on("close.modalBox",f).on("click","[data-modal]",d),a(b).on("resize",i).on("keydown",e).on("scroll",j),a.extend(a.easing,{easeOutBack:function(a,b,c,d,e,f){return void 0===f&&(f=1.70158),d*((b=b/e-1)*b*((f+1)*b+f)+1)+c},easeOutCirc:function(a,b,c,d,e){return d*Math.sqrt(1-(b=b/e-1)*b)+c}}),function(){var a="animation",b="",c="Webkit Moz O ms Khtml".split(" "),d="";if(void 0!==document.body.style.animationName&&(t=!0),t===!1)for(var e=0;e<c.length;e++)if(void 0!==document.body.style[c[e]+"AnimationName"]){d=c[e],a=d+"Animation",b="-"+d.toLowerCase()+"-",t=!0;break}}()}(jQuery,window);
//# sourceMappingURL=jquery.stackbox.min.js.map